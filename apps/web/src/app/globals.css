@import 'tailwindcss';

/* Map legacy CSS custom properties to Tailwind v4 theme variables so utility classes exist. */
@theme inline {
  --color-background: hsl(var(--background));
  --color-foreground: hsl(var(--foreground));
  --color-border: hsl(var(--border));
  --color-input: hsl(var(--input));
  --color-ring: hsl(var(--ring));
  --color-primary: hsl(var(--primary));
  --color-primary-foreground: hsl(var(--primary-foreground));
  --color-secondary: hsl(var(--secondary));
  --color-secondary-foreground: hsl(var(--secondary-foreground));
  --color-destructive: hsl(var(--destructive));
  --color-destructive-foreground: hsl(var(--destructive-foreground));
  --color-muted: hsl(var(--muted));
  --color-muted-foreground: hsl(var(--muted-foreground));
  --color-accent: hsl(var(--accent));
  --color-accent-foreground: hsl(var(--accent-foreground));
  --color-popover: hsl(var(--popover));
  --color-popover-foreground: hsl(var(--popover-foreground));
  --color-card: hsl(var(--card));
  --color-card-foreground: hsl(var(--card-foreground));
}

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;

    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;

    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;

    --primary: 222.2 47.4% 11.2%;
    --primary-foreground: 210 40% 98%;

    --secondary: 210 40% 96%;
    --secondary-foreground: 222.2 84% 4.9%;

    --muted: 210 40% 96%;
    --muted-foreground: 215.4 16.3% 46.9%;

    --accent: 210 40% 96%;
    --accent-foreground: 222.2 84% 4.9%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;

    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 222.2 84% 4.9%;

    --radius: 0.5rem;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;

    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;

    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;

    --primary: 210 40% 98%;
    --primary-foreground: 222.2 47.4% 11.2%;

    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;

    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;

    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;

    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 212.7 26.8% 83.9%;
  }
}

@layer base {
  * {
    /* Tailwind v4 currently doesn't generate a `border-border` utility from our custom color key. */
    /* Set the default border color directly using the design token variable. */
    border-color: hsl(var(--border));
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* React Flow Z-level layering fix */
/* Ensure edges render above nodes from other floors by using CSS transform */
.react-flow__edges {
  z-index: 10 !important;
}

.react-flow__nodes {
  z-index: 5 !important;
}

/* Keyboard shortcut styling */
.kbd {
  @apply inline-flex items-center justify-center px-2 py-1 text-xs font-mono font-semibold;
  @apply bg-muted text-muted-foreground border border-border rounded shadow-sm;
  @apply min-w-[2rem] gap-1;
}

/* ============================================
   Blockly Effect Editor Theme Styles
   ============================================ */

/* Light theme (default) */
.blocklySvg {
  background-color: #f8fafc !important;
}
.blocklyMainBackground {
  fill: #f8fafc !important;
}
.blocklyToolboxDiv {
  background-color: #f1f5f9 !important;
  color: #1e293b !important;
}
.blocklyTreeLabel {
  color: #1e293b !important;
}
.blocklyFlyout {
  background-color: #f1f5f9 !important;
}
.blocklyFlyoutBackground {
  fill: #f1f5f9 !important;
  fill-opacity: 0.95 !important;
}
.blocklyScrollbarHandle {
  fill: #94a3b8 !important;
  fill-opacity: 0.6 !important;
}
.blocklyScrollbarBackground {
  fill: transparent !important;
}
.blocklyTreeRow:hover {
  background-color: #e2e8f0 !important;
}
.blocklyTreeSelected {
  background-color: #cbd5e1 !important;
}
.blocklyTreeIcon {
  fill: #1e293b !important;
}

/* Dark theme - targets .dark class on html element */
.dark .blocklySvg {
  background-color: #1e1e2e !important;
}
.dark .blocklyMainBackground {
  fill: #1e1e2e !important;
}
.dark .blocklyToolboxDiv {
  background-color: #11111b !important;
  color: #cdd6f4 !important;
}
.dark .blocklyToolboxContents {
  background-color: #11111b !important;
}
.dark .blocklyToolboxCategory {
  background-color: #11111b !important;
}
.dark .blocklyTreeRoot {
  background-color: #11111b !important;
}
.dark .blocklyTreeRow {
  background-color: #11111b !important;
}
.dark .blocklyTreeLabel {
  color: #cdd6f4 !important;
}
.dark .blocklyTreeRowContentContainer {
  background-color: #11111b !important;
}
.dark .blocklyFlyout {
  background-color: #181825 !important;
}
.dark .blocklyFlyoutBackground {
  fill: #181825 !important;
  fill-opacity: 0.95 !important;
}
.dark .blocklyScrollbarHandle {
  fill: #585b70 !important;
  fill-opacity: 0.7 !important;
}
.dark .blocklyTreeRow:hover {
  background-color: #313244 !important;
}
.dark .blocklyTreeSelected {
  background-color: #45475a !important;
}
.dark .blocklyTreeIcon {
  fill: #cdd6f4 !important;
}
/* Category color icons in dark mode */
.dark .blocklyTreeRowContentContainer .blocklyTreeIcon {
  background-color: inherit !important;
}

/* Fallback for system dark mode preference (before .dark class is applied) */
@media (prefers-color-scheme: dark) {
  html:not(.light) .blocklySvg {
    background-color: #1e1e2e !important;
  }
  html:not(.light) .blocklyMainBackground {
    fill: #1e1e2e !important;
  }
  html:not(.light) .blocklyToolboxDiv {
    background-color: #11111b !important;
    color: #cdd6f4 !important;
  }
  html:not(.light) .blocklyToolboxContents {
    background-color: #11111b !important;
  }
  html:not(.light) .blocklyToolboxCategory {
    background-color: #11111b !important;
  }
  html:not(.light) .blocklyTreeRoot {
    background-color: #11111b !important;
  }
  html:not(.light) .blocklyTreeRow {
    background-color: #11111b !important;
  }
  html:not(.light) .blocklyTreeLabel {
    color: #cdd6f4 !important;
  }
  html:not(.light) .blocklyTreeRowContentContainer {
    background-color: #11111b !important;
  }
  html:not(.light) .blocklyFlyout {
    background-color: #181825 !important;
  }
  html:not(.light) .blocklyFlyoutBackground {
    fill: #181825 !important;
    fill-opacity: 0.95 !important;
  }
  html:not(.light) .blocklyScrollbarHandle {
    fill: #585b70 !important;
    fill-opacity: 0.7 !important;
  }
  html:not(.light) .blocklyTreeRow:hover {
    background-color: #313244 !important;
  }
  html:not(.light) .blocklyTreeSelected {
    background-color: #45475a !important;
  }
  html:not(.light) .blocklyTreeIcon {
    fill: #cdd6f4 !important;
  }
  html:not(.light) .blocklyTreeRowContentContainer .blocklyTreeIcon {
    background-color: inherit !important;
  }
}

/* Fix: Blockly scrollbar styling - hide all scrollbars */
/* The scrollbar handle has inline styles, so we need !important on everything */
.blocklyScrollbarHandle,
rect.blocklyScrollbarHandle {
  fill: transparent !important;
  fill-opacity: 0 !important;
  opacity: 0 !important;
  visibility: hidden !important;
}

.blocklyScrollbarBackground,
rect.blocklyScrollbarBackground {
  fill: transparent !important;
  fill-opacity: 0 !important;
  opacity: 0 !important;
  visibility: hidden !important;
}

/* Hide the entire scrollbar groups */
g.blocklyScrollbarVertical,
g.blocklyScrollbarHorizontal {
  display: none !important;
}
